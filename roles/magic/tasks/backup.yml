- name: Install Golang
  ansible.builtin.package:
    name: golang
    state: present

- name: Check if dockerv does exist
  ansible.builtin.shell: |
    which dockerv
  check_mode: false
  changed_when: false
  failed_when: which_dockerv.rc > 1
  register: which_dockerv

- name: Install and init dockerv
  ansible.builtin.shell: |
    go install github.com/theobori/dockerv@latest
    dockerv init
  when: which_dockerv.rc > 1

- name: Create the backup output directory
  ansible.builtin.file:
    path: /backup
    state: directory
    mode: "0755"

- name: Create full backup script
  ansible.builtin.template:
    src: backup-full.j2
    dest: /usr/local/scripts/backup-full
    mode: "0755"

- name: Creates a cron file for the daily full services backup
  ansible.builtin.cron:
    name: daily backup
    minute: "0"
    hour: "0"
    day: "*"
    month: "*"
    weekday: "*"
    user: root
    job: "PATH=\"${PATH}:/usr/local/bin\" /usr/local/scripts/backup-full"
